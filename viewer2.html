<!DOCTYPE html>

<!--
GLmol - Molecular Viewer on WebGL/Javascript
(C) Copyright 2011-2012, biochem_fan

License: dual license of MIT or LGPL3

This program uses
Three.js
https://github.com/mrdoob/three.js
Copyright (c) 2010-2011 three.js Authors. All rights reserved.
jQuery
http://jquery.org/
Copyright (c) 2011 John Resig
-->

<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, target-densitydpi=device-dpi">

        <title>GLmol - Molecular Viewer on WebGL/Javascript</title>
        <style type="text/css">
            html, body {
                width: 100%;
                height: 100%;
                margin: 0px;
            }
            body {
                overflow: hidden;
            }
            input, select, button, textarea {
                border: 1px solid white;
                background-color: black;
                color: white;
            }
            option {
                background-color: black;
                color: white;
            }
            a {
                color: white;
            }

            #glmol01 {
                width: 100%;
                height: 100%;
                background-color: black;
                position: absolute;
            }
            .settings {
                position: absolute;
                right: 0px;
                top: 10%;
                background-color: grey;
                -moz-transform: rotate(-90deg);
                -webkit-transform: rotate(-90deg);
                margin: 0px;
                padding: 10px;
                -moz-transform-origin: 110% 100%;
                -webkit-transform-origin: 110% 100%;
                -webkit-border-radius: 10px 10px 0px 0px;
                -moz-border-radius: 10px 10px 0px 0px;
            }
            .controller {
                position: absolute;
                width: 0px;
                right: 0px;
                top: 10%;
                background-color: rgba(0, 0, 0, 0.65);
                color: white;
            }

            .tabBox {
                position: absolute;
                padding: 0px;
                color: white;
                bottom: 0px;
                height: 20px;
                width: 60%;
            }
            .bottomTab {
                background-color: black;
                border: 1px solid white;
                color: white;
                margin: 0px;
                padding: 10px 10px 0px 10px;
                -webkit-border-radius: 10px 10px 0px 0px;
                -moz-border-radius: 10px 10px 0px 0px;
            }
            .insideTab {
                border: 1px solid white;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.85);
                margin: 0px;
                overflow: scroll;
            }
            .tabBox p, .tabBox h1, .tabBox ul {
                margin-left: 10px;
                font-size: 90%;
            }
        </style>
    </head>
    <body>

        <div id="glmol01"></div>









        <div id="glmol01_pdbTitle" style="position:absolute; color: white; background-color: rgba(0, 0, 0, 0.65); font-size:80%"></div>

        <script src="js/jquery-1.7.min.js"></script>
        <!-- <script src="js/Three.js"></script> -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/99/three.min.js"></script>
        <script type="text/javascript" src="js/GLmol.js"></script>
        <script type="text/javascript">
            // addTab('#glmol01_srcbox', '400px', 0);
            // addTab('#glmol01_viewbox', '400px', 1);
            // addTab('#glmol01_infobox', '400px', 2);

            var glmol01 = new GLmol('glmol01', true);
            var query = window.location.search.substring(1);
            if (query == '')
                download('pdb:2POR');
            else
                download(query);

            function download(query) {
                var baseURL = '';
                if (query.substr(0, 4) == 'pdb:') {
                    query = query.substr(4).toUpperCase();
                    if (!query.match(/^[1-9][A-Za-z0-9]{3}$/)) {
                        alert("Wrong PDB ID");
                        return;
                    }
                    uri = "http://www.pdb.org/pdb/files/" + query + ".pdb";
                } else if (query.substr(0, 4) == 'cid:') {
                    query = query.substr(4);
                    if (!query.match(/^[1-9]+$/)) {
                        alert("Wrong Compound ID");
                        return;
                    }
                    uri = "http://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/" + query + "/SDF?record_type=3d";
                }

                $('#loading').show();
                fetch(uri).then( function(ret){
                  ret.text().then(function(text){
                      glmol01.loadMoleculeStr(text);
                  })
                });
            }

            // function addTab(tabId, height, zIndex) {
            //     $(tabId + ' .bottomTab').toggle(function() {
            //         $(tabId).css('z-index', 100).animate({
            //             bottom : '0px',
            //             'height' : (window.innerWidth > 800) ? height : '600px'
            //         });
            //     }, function() {
            //         $(tabId).css('z-index', zIndex).animate({
            //             bottom : '0px',
            //             'height' : '20px'
            //         });
            //     });
            // }

            // function loadFile() {
            //     var file = $('#glmol01_file').get(0);
            //     if (file)
            //         file = file.files;
            //     if (!file || !window.FileReader || !file[0]) {
            //         alert("No file is selected. Or File API is not supported in your browser. Please try Firefox or Chrome.");
            //         return;
            //     }
            //     $('#loading').show();
            //     var reader = new FileReader();
            //     reader.onload = function() {
            //         $('#glmol01_src').val(reader.result);
            //         glmol01.loadMolecule();
            //         $('#loading').hide();
            //     };
            //     reader.readAsText(file[0]);
            // }

            // function saveImage() {
            //     glmol01.show();
            //     var imageURI = glmol01.renderer.domElement.toDataURL("image/png");
            //     window.open(imageURI);
            // }


            // $('#glmol01_reload').click(function(ev) {
            //     glmol01.defineRepresentation = defineRepFromController;
            //     glmol01.rebuildScene();
            //     glmol01.show();
            // });

            //  function defineRepFromController() {
            //     var idHeader = "#" + this.id + '_';
            //
            //     var time = new Date();
            //     var all = this.getAllAtoms();
            //     if ($(idHeader + 'biomt').attr('checked') && this.protein.biomtChains != "")
            //         all = this.getChain(all, this.protein.biomtChains);
            //     var allHet = this.getHetatms(all);
            //     var hetatm = this.removeSolvents(allHet);
            //
            //     console.log("selection " + (+new Date() - time));
            //     time = new Date();
            //
            //     this.colorByAtom(all, {});
            //     var colorMode = $(idHeader + 'color').val();
            //     if (colorMode == 'ss') {
            //         this.colorByStructure(all, 0xcc00cc, 0x00cccc);
            //     } else if (colorMode == 'chain') {
            //         this.colorByChain(all);
            //     } else if (colorMode == 'chainbow') {
            //         this.colorChainbow(all);
            //     } else if (colorMode == 'b') {
            //         this.colorByBFactor(all);
            //     } else if (colorMode == 'polarity') {
            //         this.colorByPolarity(all, 0xcc0000, 0xcccccc);
            //     }
            //     console.log("color " + (+new Date() - time));
            //     time = new Date();
            //
            //     var asu = new THREE.Object3D();
            //     var mainchainMode = $(idHeader + 'mainchain').val();
            //     var doNotSmoothen = ($(idHeader + 'doNotSmoothen').attr('checked') == 'checked');
            //     if ($(idHeader + 'showMainchain').attr('checked')) {
            //         if (mainchainMode == 'ribbon') {
            //             this.drawCartoon(asu, all, doNotSmoothen);
            //             this.drawCartoonNucleicAcid(asu, all);
            //         } else if (mainchainMode == 'thickRibbon') {
            //             this.drawCartoon(asu, all, doNotSmoothen, this.thickness);
            //             this.drawCartoonNucleicAcid(asu, all, null, this.thickness);
            //         } else if (mainchainMode == 'strand') {
            //             this.drawStrand(asu, all, null, null, null, null, null, doNotSmoothen);
            //             this.drawStrandNucleicAcid(asu, all);
            //         } else if (mainchainMode == 'chain') {
            //             this.drawMainchainCurve(asu, all, this.curveWidth, 'CA', 1);
            //             this.drawMainchainCurve(asu, all, this.curveWidth, 'O3\'', 1);
            //         } else if (mainchainMode == 'cylinderHelix') {
            //             this.drawHelixAsCylinder(asu, all, 1.6);
            //             this.drawCartoonNucleicAcid(asu, all);
            //         } else if (mainchainMode == 'tube') {
            //             this.drawMainchainTube(asu, all, 'CA');
            //             this.drawMainchainTube(asu, all, 'O3\'');
            //             // FIXME: 5' end problem!
            //         } else if (mainchainMode == 'bonds') {
            //             this.drawBondsAsLine(asu, all, this.lineWidth);
            //         }
            //     }
            //
            //     if ($(idHeader + 'line').attr('checked')) {
            //         this.drawBondsAsLine(this.modelGroup, this.getSidechains(all), this.lineWidth);
            //     }
            //     console.log("mainchain " + (+new Date() - time));
            //     time = new Date();
            //
            //     if ($(idHeader + 'showBases').attr('checked')) {
            //         var hetatmMode = $(idHeader + 'base').val();
            //         if (hetatmMode == 'nuclStick') {
            //             this.drawNucleicAcidStick(this.modelGroup, all);
            //         } else if (hetatmMode == 'nuclLine') {
            //             this.drawNucleicAcidLine(this.modelGroup, all);
            //         } else if (hetatmMode == 'nuclPolygon') {
            //             this.drawNucleicAcidLadder(this.modelGroup, all);
            //         }
            //     }
            //
            //     var target = $(idHeader + 'symopHetatms').attr('checked') ? asu : this.modelGroup;
            //     if ($(idHeader + 'showNonBonded').attr('checked')) {
            //         var nonBonded = this.getNonbonded(allHet);
            //         var nbMode = $(idHeader + 'nb').val();
            //         if (nbMode == 'nb_sphere') {
            //             this.drawAtomsAsIcosahedron(target, nonBonded, 0.3, true);
            //         } else if (nbMode == 'nb_cross') {
            //             this.drawAsCross(target, nonBonded, 0.3, true);
            //
            //         }
            //     }
            //
            //     if ($(idHeader + 'showHetatms').attr('checked')) {
            //         var hetatmMode = $(idHeader + 'hetatm').val();
            //         if (hetatmMode == 'stick') {
            //             this.drawBondsAsStick(target, hetatm, this.cylinderRadius, this.cylinderRadius, true);
            //         } else if (hetatmMode == 'sphere') {
            //             this.drawAtomsAsSphere(target, hetatm, this.sphereRadius);
            //         } else if (hetatmMode == 'line') {
            //             this.drawBondsAsLine(target, hetatm, this.curveWidth);
            //         } else if (hetatmMode == 'icosahedron') {
            //             this.drawAtomsAsIcosahedron(target, hetatm, this.sphereRadius);
            //         } else if (hetatmMode == 'ballAndStick') {
            //             this.drawBondsAsStick(target, hetatm, this.cylinderRadius / 2.0, this.cylinderRadius, true, false, 0.3);
            //         } else if (hetatmMode == 'ballAndStick2') {
            //             this.drawBondsAsStick(target, hetatm, this.cylinderRadius / 2.0, this.cylinderRadius, true, true, 0.3);
            //         }
            //
            //     }
            //     console.log("hetatms " + (+new Date() - time));
            //     time = new Date();
            //
            //     var projectionMode = $(idHeader + 'projection').val();
            //     if (projectionMode == 'perspective')
            //         this.camera = this.perspectiveCamera;
            //     else if (projectionMode == 'orthoscopic')
            //         this.camera = this.orthoscopicCamera;
            //
            //     this.setBackground(parseInt($(idHeader + 'bgcolor').val()));
            //
            //     if ($(idHeader + 'cell').attr('checked')) {
            //         this.drawUnitcell(this.modelGroup);
            //     }
            //
            //     if ($(idHeader + 'biomt').attr('checked')) {
            //         this.drawSymmetryMates2(this.modelGroup, asu, this.protein.biomtMatrices);
            //     }
            //     if ($(idHeader + 'packing').attr('checked')) {
            //         this.drawSymmetryMatesWithTranslation2(this.modelGroup, asu, this.protein.symMat);
            //     }
            //     this.modelGroup.add(asu);
            //
            //     console.log(this)
            // };

          //glmol01.defineRepresentation = defineRepFromController;

        </script>

    </body>
</html>
